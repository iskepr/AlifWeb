function تحليل_الشفرة(شفرة) {
    const كلمات = [
        "دالة",
        "اذا",
        "والا",
        "اواذا",
        "بينما",
        "لاجل",
        "في",
        "ارجع",
        "توقف",
        "استمر",
        "صح",
        "خطا",
        "عدم",
        "و",
        "او",
        "ليس",
        "صنف",
        "استورد",
        "من",
        "لاجل",
        "اطبع",
        "نص",
    ];

    const نمط_الرموز = [
        { النوع: "مسافة", regex: /^[ \t]+/ },
        { النوع: "تعليق", regex: /^#.*\n?/ },
        { النوع: "سطر_جديد", regex: /^\n/ },
        {
            النوع: "معرف",
            regex: /^[a-zA-Z\u0600-\u06FF_][a-zA-Z0-9\u0600-\u06FF_]*/,
        },
        { النوع: "رقم", regex: /^\d+(\.\d+)?/ },
        { النوع: "نص", regex: /^(['"])(.*?)\1/ },
        {
            النوع: "رمز_حسابي",
            regex: /^(==|!=|<=|>=|<|>|\+|\-|\*|\\|\\\\|\*\\|\^|\^\\|:|،)/,
        },
        { النوع: "اقواس", regex: /^(\(|\)|\[|\]|\{|\}|\.)/ },
        { النوع: "فاصلة", regex: /,/ },
        { النوع: "علامة_إسناد", regex: /^=/ },
    ];

    let رموز = [];
    let سطر = 1;
    let التبويب_الحالي = 0;

    while (شفرة.length > 0) {
        let matched = false;

        for (const النمط of نمط_الرموز) {
            const match = شفرة.match(النمط.regex);
            if (match) {
                const القيمة = match[0];

                if (النمط.النوع === "مسافة") {
                    // قياس التبويب بناءً على المسافات
                    if (القيمة.includes("\t") || القيمة.includes(" ")) {
                        const عدد_المسافات = القيمة.length;
                        if (عدد_المسافات > التبويب_الحالي) {
                            التبويب_الحالي = عدد_المسافات; // زيادة التبويب
                        } else if (عدد_المسافات < التبويب_الحالي) {
                            التبويب_الحالي = عدد_المسافات; // تقليل التبويب
                        }
                    }
                } else if (النمط.النوع === "تعليق") {
                    if (القيمة.includes("\n")) سطر++;
                } else if (النمط.النوع === "سطر_جديد") {
                    رموز.push({ النوع: "سطر_جديد", القيمة: "\n", سطر });
                    سطر++;
                } else if (النمط.النوع === "معرف" && كلمات.includes(القيمة)) {
                    رموز.push({ النوع: "كلمة", القيمة, سطر });
                } else {
                    رموز.push({ النوع: النمط.النوع, القيمة, سطر });
                }

                شفرة = شفرة.slice(القيمة.length);
                matched = true;
                break;
            }
        }

        if (!matched) {
            throw new Error(`رمزغير معروف في سطر ${سطر}: ${شفرة.slice(0, 10)}`);
        }
    }

    return رموز;
}

module.exports = { تحليل_الشفرة };
