function تحليل_الشفرة(الشفرة) {
    const الكلمات = [
        "ارجع",
        "توقف",
        "استمر",
        "صح",
        "خطا",
        "خطأ",
        "عدم",
        "استورد",
        "اطبع",
        "اشعار",
        "طول",
        "ادنى",
        "اقصى",
        "ادخل",
        "اضف",
        "امسح",
        "ادرج",
        "مفاتيح",
        "عام",
        "صحيح",
        "عشري",
        "مصفوفة",
        "لاجل",
        "لأجل",
        "بينما",
        "اذا",
        "إذا",
        "اواذا",
        "اوإذا",
        "والا",
        "وإلا",
        "و",
        "او",

        "دالة",
        "في",
        "ليس",
        "صنف",
        "من",
        //  الواجه
        "صفحة",
        "نص",
        "رابط",
        "عمودي",
        "رأسي",
        "توسيط",
        "بطاقة",
    ];

    const نمط_الرموز = [
        { النوع: "مسافة", regex: /^[ \t]+/ },
        { النوع: "تعليق", regex: /^#.*\n?/ },
        { النوع: "سطر_جديد", regex: /^\n/ },
        { النوع: "اقواس", regex: /^(\(|\)|\[|\]|\{|\}|\.)/ },
        { النوع: "فاصلة", regex: /^,/ },
        { النوع: "علامة_إسناد", regex: /^=/ },
        { النوع: "رقم", regex: /^\d+(\.\d+)?/ },
        { النوع: "نص", regex: /^(['"])(.*?)\1/ },
        {
            النوع: "معرف",
            regex: /^[a-zA-Z\u0600-\u06FF_][a-zA-Z0-9\u0600-\u06FF_]*/,
        },
        {
            النوع: "رمز_حسابي",
            regex: /^(==|!=|<=|>=|<|>|\+|\-|\*|\\|\\\\|\*\\|\^|\^\\|:|؛|،)/,
        },
    ];

    let الرموز = [];
    let السطر = 1;

    while (الشفرة.length > 0) {
        let متطابق = false;

        // التعامل مع المسافات في بداية السطر
        if (نمط_الرموز[0].regex.test(الشفرة)) {
            const المسافة = الشفرة.match(نمط_الرموز[0].regex)[0];
            if (المسافة.length > 1) {
                الرموز.push({ النوع: "مسافة", القيمة: المسافة, السطر });
            }
            الشفرة = الشفرة.slice(المسافة.length); // إذالة المسافة من الشفرة
        }

        for (const النمط of نمط_الرموز) {
            const تطابق = الشفرة.match(النمط.regex);
            if (تطابق) {
                const القيمة = تطابق[0];
                if (النمط.النوع === "تعليق") {
                    if (القيمة.includes("\n")) السطر++; // تجاهل التعليق
                } else if (النمط.النوع === "سطر_جديد") {
                    الرموز.push({ النوع: "سطر_جديد", القيمة: "\n", السطر });
                    السطر++;
                } else if (النمط.النوع === "معرف" && الكلمات.includes(القيمة)) {
                    الرموز.push({ النوع: "كلمة", القيمة, السطر });
                } else {
                    الرموز.push({ النوع: النمط.النوع, القيمة, السطر });
                }

                الشفرة = الشفرة.slice(القيمة.length);
                متطابق = true;
                break;
            }
        }

        if (!متطابق) {
            throw new Error(
                `رمز غير معروف في السطر ${السطر}: ${الشفرة.slice(0, 10)}`
            );
        }
    }

    return الرموز;
}

module.exports = { تحليل_الشفرة };
